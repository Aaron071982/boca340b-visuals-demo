graph TD
    A[Browser/Client] -->|HTTPS| B[public/index.php]
    B --> C[Laravel Bootstrap]
    C --> D[app/Http/Kernel.php]
    
    D -->|Web Routes| E[routes/web.php]
    D -->|API Routes| F[routes/api.php]
    
    E -->|/admin/*| G[Backend Controllers]
    E -->|/login| H[CustomAuthController]
    E -->|/inbound_message| I[CustomerSmsController]
    
    F -->|/api/v1/*| J[Api/V1 Controllers]
    F -->|/api/mailgun/*| K[MailgunWidgetsController]
    
    G --> L[Backend Repositories]
    J --> M[Api Repositories]
    
    L --> N[Eloquent Models]
    M --> N
    
    N -->|Central DB| O[(mysql: users, roles, locations)]
    N -->|Tenant DB| P[(Dynamic DB: customers, orders, inventory)]
    
    G --> Q[Services]
    Q --> R[OtpServices]
    Q --> S[FedExWebServices]
    
    Q --> T[Mailgun API]
    Q --> U[Twilio/Vonage/RingCentral]
    Q --> V[Square SDK]
    Q --> W[FedEx API]
    
    H -->|OTP SMS/Email| T
    I -->|SMS Callback| U
    
    D -->|Middleware| X[auth: session]
    D -->|Middleware| Y[auth:api: Passport]
    D -->|Middleware| Z[ValidateMailgunWebhook]
    
    A -->|SPA/Vue 2| AA[Blade + Vue Components]
    AA -->|AJAX| E
    AA -->|AJAX| F
    
    style O fill:#e1f5ff
    style P fill:#fff4e1
    style T fill:#ffe1f5
    style U fill:#ffe1f5
    style V fill:#ffe1f5
    style W fill:#ffe1f5

